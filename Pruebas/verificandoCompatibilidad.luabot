<xml xmlns="http://www.w3.org/1999/xhtml"><block type="variables_set" x="38" y="-87"><field name="VAR">PIR</field><value name="VALUE"><block type="math_number"><field name="NUM">7</field></block></value><next><block type="variables_set"><field name="VAR">foco</field><value name="VALUE"><block type="math_number"><field name="NUM">1</field></block></value><next><block type="variables_set"><field name="VAR">sirena</field><value name="VALUE"><block type="math_number"><field name="NUM">2</field></block></value><next><block type="variables_set"><field name="VAR">counter</field><value name="VALUE"><block type="math_number"><field name="NUM">0</field></block></value><next><block type="variables_set"><field name="VAR">alarm_0</field><value name="VALUE"><block type="math_number"><field name="NUM">0</field></block></value><next><block type="variables_set"><field name="VAR">automatico</field><value name="VALUE"><block type="math_number"><field name="NUM">1</field></block></value><next><block type="gpio_mode"><field name="gpio_set">INPUT</field><value name="gpio"><block type="variables_get"><field name="VAR">PIR</field></block></value><next><block type="gpio_mode"><field name="gpio_set">OUTPUT</field><value name="gpio"><block type="variables_get"><field name="VAR">foco</field></block></value><next><block type="gpio_mode"><field name="gpio_set">OUTPUT</field><value name="gpio"><block type="variables_get"><field name="VAR">sirena</field></block></value><next><block type="wfi_set_mode"><field name="modo">wifi.SOFTAP</field><next><block type="wifi_ap_config"><field name="ssid">rita_camelo</field><field name="password">18031935</field><next><block type="page_html"><field name="title">Alarma Gallinero</field><statement name="buttons"><block type="html_text"><field name="text">Automatico</field><next><block type="button_statement"><field name="buttons">b0</field><field name="NAME">ON</field><next><block type="button_statement"><field name="buttons">b1</field><field name="NAME">OFF</field><next><block type="html_text"><field name="text">Manual</field><next><block type="button_statement"><field name="buttons">b2</field><field name="NAME">Bombillo</field><next><block type="button_statement"><field name="buttons">b3</field><field name="NAME">Sirena</field></block></next></block></next></block></next></block></next></block></next></block></statement><statement name="logic"><block type="controls_if"><mutation elseif="3"></mutation><value name="IF0"><block type="button"><field name="buttons">b0</field></block></value><statement name="DO0"><block type="variables_set"><field name="VAR">automatico</field><value name="VALUE"><block type="math_number"><field name="NUM">1</field></block></value></block></statement><value name="IF1"><block type="button"><field name="buttons">b1</field></block></value><statement name="DO1"><block type="variables_set"><field name="VAR">automatico</field><value name="VALUE"><block type="math_number"><field name="NUM">0</field></block></value></block></statement><value name="IF2"><block type="button"><field name="buttons">b2</field></block></value><statement name="DO2"><block type="procedures_callnoreturn"><mutation name="toggle"><arg name="x"></arg></mutation><value name="ARG0"><block type="variables_get"><field name="VAR">foco</field></block></value></block></statement><value name="IF3"><block type="button"><field name="buttons">b3</field></block></value><statement name="DO3"><block type="procedures_callnoreturn"><mutation name="toggle"><arg name="x"></arg></mutation><value name="ARG0"><block type="variables_get"><field name="VAR">sirena</field></block></value></block></statement></block></statement><next><block type="procedures_callnoreturn"><mutation name="retardo"><arg name="segundos"></arg></mutation><value name="ARG0"><block type="math_number"><field name="NUM">10</field></block></value><next><block type="timer_alarm"><value name="id"><block type="math_number"><field name="NUM">0</field></block></value><value name="delay"><block type="math_number"><field name="NUM">250</field></block></value><value name="repeat"><block type="math_number"><field name="NUM">1</field></block></value><statement name="do"><block type="controls_if"><mutation else="1"></mutation><value name="IF0"><block type="logic_compare"><field name="OP">EQ</field><value name="A"><block type="variables_get"><field name="VAR">automatico</field></block></value><value name="B"><block type="math_number"><field name="NUM">1</field></block></value></block></value><statement name="DO0"><block type="controls_if"><value name="IF0"><block type="logic_compare"><field name="OP">EQ</field><value name="A"><block type="variables_get"><field name="VAR">alarm_0</field></block></value><value name="B"><block type="math_number"><field name="NUM">0</field></block></value></block></value><statement name="DO0"><block type="controls_if"><value name="IF0"><block type="logic_compare"><field name="OP">EQ</field><value name="A"><block type="gpio_read"><value name="gpio"><block type="variables_get"><field name="VAR">PIR</field></block></value></block></value><value name="B"><block type="math_number"><field name="NUM">1</field></block></value></block></value><statement name="DO0"><block type="variables_set"><field name="VAR">alarm_0</field><value name="VALUE"><block type="math_number"><field name="NUM">1</field></block></value></block></statement></block></statement></block></statement><statement name="ELSE"><block type="variables_set"><field name="VAR">alarm_0</field><value name="VALUE"><block type="math_number"><field name="NUM">0</field></block></value></block></statement><next><block type="controls_if"><mutation elseif="1"></mutation><value name="IF0"><block type="logic_operation"><field name="OP">AND</field><value name="A"><block type="logic_compare"><field name="OP">EQ</field><value name="A"><block type="variables_get"><field name="VAR">counter</field></block></value><value name="B"><block type="math_number"><field name="NUM">1</field></block></value></block></value><value name="B"><block type="logic_compare"><field name="OP">EQ</field><value name="A"><block type="variables_get"><field name="VAR">alarm_0</field></block></value><value name="B"><block type="math_number"><field name="NUM">1</field></block></value></block></value></block></value><statement name="DO0"><block type="gpio_write"><field name="state">gpio.HIGH</field><value name="gpio"><block type="variables_get"><field name="VAR">foco</field></block></value><next><block type="procedures_callnoreturn"><mutation name="retardo"><arg name="segundos"></arg></mutation><value name="ARG0"><block type="math_number"><field name="NUM">8</field></block></value></block></next></block></statement><value name="IF1"><block type="logic_operation"><field name="OP">AND</field><value name="A"><block type="logic_compare"><field name="OP">GT</field><value name="A"><block type="variables_get"><field name="VAR">counter</field></block></value><value name="B"><block type="math_number"><field name="NUM">40</field></block></value></block></value><value name="B"><block type="logic_compare"><field name="OP">EQ</field><value name="A"><block type="variables_get"><field name="VAR">alarm_0</field></block></value><value name="B"><block type="math_number"><field name="NUM">1</field></block></value></block></value></block></value><statement name="DO1"><block type="controls_if"><value name="IF0"><block type="logic_compare"><field name="OP">EQ</field><value name="A"><block type="gpio_read"><value name="gpio"><block type="variables_get"><field name="VAR">PIR</field></block></value></block></value><value name="B"><block type="math_number"><field name="NUM">1</field></block></value></block></value><statement name="DO0"><block type="gpio_write"><field name="state">gpio.HIGH</field><value name="gpio"><block type="variables_get"><field name="VAR">sirena</field></block></value><next><block type="procedures_callnoreturn"><mutation name="retardo"><arg name="segundos"></arg></mutation><value name="ARG0"><block type="math_number"><field name="NUM">15</field></block></value><next><block type="gpio_write"><field name="state">gpio.LOW</field><value name="gpio"><block type="variables_get"><field name="VAR">foco</field></block></value><next><block type="gpio_write"><field name="state">gpio.LOW</field><value name="gpio"><block type="variables_get"><field name="VAR">sirena</field></block></value><next><block type="variables_set"><field name="VAR">alarm_0</field><value name="VALUE"><block type="math_number"><field name="NUM">0</field></block></value><next><block type="variables_set"><field name="VAR">counter</field><value name="VALUE"><block type="math_number"><field name="NUM">0</field></block></value></block></next></block></next></block></next></block></next></block></next></block></statement></block></statement><next><block type="controls_if"><value name="IF0"><block type="logic_compare"><field name="OP">EQ</field><value name="A"><block type="variables_get"><field name="VAR">alarm_0</field></block></value><value name="B"><block type="math_number"><field name="NUM">1</field></block></value></block></value><statement name="DO0"><block type="variables_set"><field name="VAR">counter</field><value name="VALUE"><block type="math_arithmetic"><field name="OP">ADD</field><value name="A"><shadow type="math_number"><field name="NUM">1</field></shadow><block type="variables_get"><field name="VAR">counter</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block></value></block></statement><next><block type="controls_if"><value name="IF0"><block type="logic_operation"><field name="OP">AND</field><value name="A"><block type="logic_compare"><field name="OP">EQ</field><value name="A"><block type="variables_get"><field name="VAR">counter</field></block></value><value name="B"><block type="math_number"><field name="NUM">60</field></block></value></block></value><value name="B"><block type="logic_compare"><field name="OP">EQ</field><value name="A"><block type="variables_get"><field name="VAR">alarm_0</field></block></value><value name="B"><block type="math_number"><field name="NUM">1</field></block></value></block></value></block></value><statement name="DO0"><block type="variables_set"><field name="VAR">counter</field><value name="VALUE"><block type="math_number"><field name="NUM">0</field></block></value><next><block type="variables_set"><field name="VAR">alarm_0</field><value name="VALUE"><block type="math_number"><field name="NUM">0</field></block></value><next><block type="gpio_write"><field name="state">gpio.LOW</field><value name="gpio"><block type="variables_get"><field name="VAR">foco</field></block></value></block></next></block></next></block></statement></block></next></block></next></block></next></block></statement><next><block type="variables_set"><field name="VAR">temporizador</field><value name="VALUE"><block type="math_number"><field name="NUM">0</field></block></value><next><block type="timer_alarm"><value name="id"><block type="math_number"><field name="NUM">1</field></block></value><value name="delay"><block type="math_number"><field name="NUM">60000</field></block></value><value name="repeat"><block type="math_number"><field name="NUM">1</field></block></value><statement name="do"><block type="variables_set"><field name="VAR">temporizador</field><value name="VALUE"><block type="math_arithmetic"><field name="OP">ADD</field><value name="A"><shadow type="math_number"><field name="NUM">1</field></shadow><block type="variables_get"><field name="VAR">temporizador</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">1</field></shadow><block type="math_number"><field name="NUM">1</field></block></value></block></value><next><block type="controls_if"><mutation elseif="1"></mutation><value name="IF0"><block type="logic_compare"><field name="OP">EQ</field><value name="A"><block type="variables_get"><field name="VAR">temporizador</field></block></value><value name="B"><block type="math_number"><field name="NUM">480</field></block></value></block></value><statement name="DO0"><block type="variables_set"><field name="VAR">automatico</field><value name="VALUE"><block type="math_number"><field name="NUM">0</field></block></value></block></statement><value name="IF1"><block type="logic_compare"><field name="OP">EQ</field><value name="A"><block type="variables_get"><field name="VAR">temporizador</field></block></value><value name="B"><block type="math_number"><field name="NUM">1440</field></block></value></block></value><statement name="DO1"><block type="variables_set"><field name="VAR">temporizador</field><value name="VALUE"><block type="math_number"><field name="NUM">0</field></block></value><next><block type="variables_set"><field name="VAR">automatico</field><value name="VALUE"><block type="math_number"><field name="NUM">1</field></block></value></block></next></block></statement></block></next></block></statement></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block><block type="procedures_defnoreturn" x="538" y="437"><mutation><arg name="x"></arg></mutation><field name="NAME">toggle</field><statement name="STACK"><block type="controls_if"><mutation else="1"></mutation><value name="IF0"><block type="logic_compare"><field name="OP">EQ</field><value name="A"><block type="math_number"><field name="NUM">1</field></block></value><value name="B"><block type="gpio_read"><value name="gpio"><block type="variables_get"><field name="VAR">x</field></block></value></block></value></block></value><statement name="DO0"><block type="gpio_write"><field name="state">gpio.LOW</field><value name="gpio"><block type="variables_get"><field name="VAR">x</field></block></value></block></statement><statement name="ELSE"><block type="gpio_write"><field name="state">gpio.HIGH</field><value name="gpio"><block type="variables_get"><field name="VAR">x</field></block></value></block></statement></block></statement></block><block type="procedures_defnoreturn" x="513" y="637"><mutation><arg name="segundos"></arg></mutation><field name="NAME">retardo</field><statement name="STACK"><block type="controls_for"><field name="VAR">i</field><value name="FROM"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="TO"><shadow type="math_number"><field name="NUM">10</field></shadow><block type="variables_get"><field name="VAR">segundos</field></block></value><value name="BY"><shadow type="math_number"><field name="NUM">1</field></shadow></value><statement name="DO"><block type="controls_for"><field name="VAR">j</field><value name="FROM"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="TO"><shadow type="math_number"><field name="NUM">10</field></shadow><block type="math_number"><field name="NUM">1000</field></block></value><value name="BY"><shadow type="math_number"><field name="NUM">1</field></shadow></value><statement name="DO"><block type="timer_delay"><value name="delay"><block type="math_number"><field name="NUM">1000</field></block></value></block></statement></block></statement></block></statement></block></xml>